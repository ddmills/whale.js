(function(){var t=this,n=t.whale,e=function(t){return t instanceof e?e:this instanceof e?void(this._Wrapped=t):new e(t)};t.whale=e,e.VERSION="0.0.1",e.noConflict=function(){return t.whale=n,this};var i,s=/xyz/.test(function(){})?/\b_super\b/:/.*/,r=e.Class=function(){};r.prototype.initialize=function(){this._id=u()},r.extend=function(t){function n(){i||(this.initialize&&this.initialize.apply(this,arguments),this.construct&&this.construct.apply(this,arguments))}var e,r,o;e=this.prototype,i=!0,r=new this,i=!1;for(o in t)r[o]="initialize"!=o&&"function"==typeof t[o]&&"function"==typeof e[o]&&s.test(t[o])?function(t,n){return function(){var i,s;return i=this._super,this._super=e[t],s=n.apply(this,arguments),this._super=i,s}}(o,t[o]):t[o],"initialize"==o&&(r[o]=function(){e.initialize.apply(this),t.initialize.apply(this)});return n.prototype=r,n.prototype.constructor=n,n.extend=arguments.callee,n};{var o=0,u=e.genId=function(t){var n=++o+"";return t?t+n:n},c={},a=e.get=function(t){if(!c[t])throw'whale inject cannot resolve given dependency "'+t+'"... could not find it in list registered dependencies';return c[t]},h=(e.make=function(t){var n,e,i,s;return e=a(t),n=Array.prototype.slice.call(arguments,1),"function"==typeof e?(i=function(){},i.prototype=e.prototype,s=new i,ret=e.apply(s,n),Object(ret)===ret?ret:s):e},e.register=function(t,n){return c[t]=n,c[t]}),l=e.inject=function(t,n){var i,s;for(i=[],s=0;s<t.length;s++)i.push(e.get(t[s]));return n.extend({construct:function(){this._super&&this._super.apply(this,i.concat(Array.prototype.slice.call(arguments,0)))}})},f=(e.Factory=function(t,n,e){var i=l(n,r.extend(e));return null!=t?h(t,i):i},e.Service=function(t,n,e){var i=new(l(n,r.extend(e)));return null!=t?h(t,i):i},e.Dispatcher=r.extend({initialize:function(){this._events=[]},_dispatch:function(t){if(!this._events[t])return this;for(var n=0;n<this._events[t].length;n++){var e=this._events[t][n];if("function"==typeof e.action)e.action.call(e.ctx,this);else{var i=e.ctx[e.action];i.call(e.ctx,this)}}return this},trigger:function(){for(var t=0;t<arguments.length;t++)this._dispatch(arguments[t]);return this},when:function(t,n,e){var i=this._events[t]||(this._events[t]=[]);return e=e||this,i.push({action:n,ctx:e}),this},stop:function(t,n,e){var i;if(!t&&!n&&!e)return this._events=[],this;for(evntKeys=t?[t]:Object.keys(this._events),i=0;i<evntKeys.length;i++){var s,r,o,u;if(t=evntKeys[i],s=this._events[t])if(n||e){for(r=[],u=0;u<s.length;u++)o=s[u],(n&&n!==o.action&&n!==o.action._action||e&&e!==o.ctx)&&r.push(o);r.length?this._events[t]=r:delete this._events[t]}else delete this._events[t]}return this}})),p=e.Listener=r.extend({initialize:function(){this._listening={}},listen:function(t,n,e,i){i=i||this;var s=t._id;return this._listening[s]=t,t.when(n,e,i),this},listenOnce:function(t,n,e,i){i=i||this;var s=function(){this.stopListening(t,n,s),e.apply(this,arguments)};return s._action=e,this.listen(t,n,s,i)},stopListening:function(t,n,e,i){var s,r;s=t._id,i=i||this;for(var s in this._listening)r=this._listening[s],r.stop(n,e,i);return Object.keys(this._listening[s]).length||delete this._listening[s],this}});e.View=function(t,n,e){var i=l(n,f.extend(e));return null!=t?h(t,i):i},e.Controller=function(t,n,e){var i=l(n,p.extend(e));return null!=t?h(t,i):i}}}).call(this);