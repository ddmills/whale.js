!(function(){var t=this,n=t.whale,i=function(t){return t instanceof i?i:this instanceof i?void(this._Wrapped=t):new i(t)};t.whale=i,i.VERSION="0.0.1",i.noConflict=function(){return t.whale=n,this};var r,s=/xyz/.test(function(){})?/\b_super\b/:/.*/,o=i.Class=function(){};o.prototype.initialize=function(){this._id=a()},o.extend=function(t){function e(){r||(this.initialize&&this.initialize.apply(this,arguments),this.construct&&this.construct.apply(this,arguments))}var n,i,o;n=this.prototype,r=!0,i=new this,r=!1;for(o in t)i[o]="initialize"!=o&&/^f/.test(typeof t[o])&&/^f/.test(typeof n[o])&&s.test(t[o])?function(t,e){return function(){var i,r;return i=this._super,this._super=n[t],r=e.apply(this,arguments),this._super=i,r}}(o,t[o]):t[o],"initialize"==o&&(i[o]=function(){n.initialize.apply(this),t.initialize.apply(this)});return e.prototype=i,e.prototype.constructor=e,e.extend=arguments.callee,e};{var c=0,a=i.genId=function(t){var e=++c+"";return t?t+e:e},h={},u=i.get=function(t){if(!h[t])throw'whale inject cannot resolve given dependency "'+t+'"... could not find it in list registered dependencies';return h[t]},l=(i.make=function(t){var e,n,i,r;return n=u(t),e=Array.prototype.slice.call(arguments,1),/^f/.test(typeof n)?(i=function(){},i.prototype=n.prototype,r=new i,ret=n.apply(r,e),Object(ret)===ret?ret:r):n},i.register=function(t,e){return h[t]=e,h[t]}),f=i.inject=function(t,e){var n,r;for(n=[],r=0;r<t.length;r++)n.push(i.get(t[r]));return e.extend({construct:function(){this._super&&this._super.apply(this,n.concat(Array.prototype.slice.call(arguments,0)))}})},p=(i.Factory=function(t,e,n){var i=f(e,o.extend(n));return null!=t?l(t,i):i},i.Service=function(t,e,n){var i=new(f(e,o.extend(n)));return null!=t?l(t,i):i},i.Dispatcher=o.extend({initialize:function(){this._events=[]},_dispatch:function(t){var e=this._events[t];if(!e)return this;for(var n=0;n<e.length;n++){var i=e[n];if(/^f/.test(typeof i.action))i.action.call(i.ctx,this);else{var r=i.ctx[i.action];r.call(i.ctx,this)}}return this},trigger:function(){for(var t=0;t<arguments.length;t++)this._dispatch(arguments[t]);return this},when:function(t,e,n){var i=this._events[t]||(this._events[t]=[]);return n=n||this,i.push({action:e,ctx:n}),this},stop:function(t,e,n){var i;if(!t&&!e&&!n)return this._events=[],this;for(evntKeys=t?[t]:Object.keys(this._events),i=0;i<evntKeys.length;i++){var r,s,o,c;if(t=evntKeys[i],r=this._events[t])if(e||n){for(s=[],c=0;c<r.length;c++)o=r[c],(e&&e!==o.action&&e!==o.action._action||n&&n!==o.ctx)&&s.push(o);s.length?this._events[t]=s:delete this._events[t]}else delete this._events[t]}return this}})),d=i.Listener=o.extend({initialize:function(){this._listening={}},listen:function(t,e,n,i){i=i||this;var r=t._id;return this._listening[r]=t,t.when(e,n,i),this},listenOnce:function(t,e,n,i){i=i||this;var r=function(){this.stopListening(t,e,r),n.apply(this,arguments)};return r._action=n,this.listen(t,e,r,i)},stopListening:function(t,e,n,i){var r,s;if(i=i||this,!t&&!e&&!n){for(var r in this._listening)s=this._listening[r],s.stop(e,n,i),Object.keys(this._listening[r]).length||delete this._listening[r];return this}if(!(t instanceof p))throw"First argument was not a valid Dispatcher object";return r=t._id,s=this._listening[r],s.stop(e,n,i),Object.keys(this._listening[r]).length||delete this._listening[r],this}});i.Model=p.extend({}),i.View=function(t,e,n){var i=f(e,p.extend(n));return null!=t?l(t,i):i},i.Controller=function(t,e,n){var i=f(e,d.extend(n));return null!=t?l(t,i):i}}i.register("whale.node",i.Class.extend({splice:Array.prototype.splice,init:function(){this.length=0},construct:function(t){if(t.constructor===Array)this.elem=t;else if(t&&t.nodeType)this.elem=[t];else if("string"==typeof t){this.elem=[];var e=document.createElement("div");e.innerHTML=t;for(var n=e.childNodes.length-1;n>=0;n--)this.elem[n]=e.childNodes[n]}},on:function(t,e,n){var i=this;return n=n||this,this.each(function(r){r.addEventListener(t,function(){e.call(n,i)})})},off:function(t,e){return this.each(function(n){n.removeEventListener(t,e)})},remove:function(){return this.each(function(t){t.parentNode.removeChild(t)})},addClass:function(t){return this.each(function(e){e.className+=" "+t})},each:function(t){for(var e=0;e<this.elem.length;e++)t(this.elem[e]);return this},outer:function(){return this.elem[0].outerHTML},html:function(t){return t||""===t?this.each(t instanceof this.constructor?function(e){e.innerHTML="",t.each(function(t){e.appendChild(t)})}:function(e){e.innerHTML=t}):this.elem[0].innerHTML},append:function(t){return t instanceof this.constructor?this.each(function(e){t.each(function(t){e.appendChild(t)})}):e.insertAdjacentHTML("beforeend",t)},prepend:function(t){return t instanceof this.constructor?this.each(function(e){t.each(function(t){e.insertBefore(t,e.firstChild)})}):e.insertAdjacentHTML("afterbegin",t)},before:function(t){return this.each(t instanceof this.constructor?function(e){t.each(function(t){e.parentNode.insertBefore(t,e)})}:function(e){e.insertAdjacentHTML("beforebegin",t)})},after:function(t){var e=this;return this.each(t instanceof e.constructor?function(e){t.each(function(t){e.parentNode.insertBefore(t,e.nextSibling)})}:function(e){e.insertAdjacentHTML("afterend",t)})},find:function(t){var e=[];return this.each(function(n){for(var i=n.querySelectorAll(t),r=i.length-1;r>=0;r--)e[r]=i[r]}),new this.constructor(e)}})),i.Service("whale.dom",["whale.node"],{_matches:{"#":"getElementById",".":"getElementsByClassName","@":"getElementsByName","=":"getElementsByTagName"},construct:function(t){this.node=t},find:function(t,e){return e=e||/\s/.test(t),new this.node(!e&&this._matches[t[0]]?document[this._matches[t[0]]](t.slice(1)):document.querySelectorAll(t))}})}).call(this);